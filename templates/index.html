<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Streamrip Web</title>
  <link rel="stylesheet" href="/static/style.css?v={{ app_version }}">
  <link rel="icon" type="image/png" href="/static/favicon.png">
</head>
<body>
  <header class="header">
    <div>
        <h1><img src="/static/logo.png" width="32" height="32" border="0"> Streamrip Web</h1>
      <p class="subtitle">Full-featured web UI for the streamrip module</p>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-tab="search">Search</button>
    <button class="tab" data-tab="url">URL</button>
    <button class="tab" data-tab="saved">Saved for later</button>
    <button class="tab" data-tab="settings">Settings</button>
  </nav>

  <main>
    <section id="tab-search" class="tab-pane active">
      <div class="card" id="search-card">
        <div class="card-header">
          <div>
            <h2>Search</h2>
          </div>
          <div class="sse-status error" id="sse-status">Offline</div>
        </div>
        <form id="search-form" class="search-form">
          <div class="search-grid">
            <label>
              Source
              <select name="source" required>
                <option value="qobuz">Qobuz</option>
                <option value="tidal">Tidal</option>
                <option value="deezer">Deezer</option>
                <option value="soundcloud">SoundCloud</option>
              </select>
            </label>
            <label>
              Media type
              <select name="media_type" required>
                <option value="album">Album</option>
                <option value="track">Track</option>
                <option value="artist">Artist</option>
                <option value="playlist">Playlist</option>
                <option value="label">Label</option>
              </select>
            </label>
            <label>
              Max results
              <input type="number" name="limit" value="25" min="1" max="200">
            </label>
          </div>
          <div class="query-row">
            <label class="query-label" for="search-query">Query</label>
            <div class="query-input">
              <input id="search-query" type="search" name="query" placeholder="Artist, album, playlist…" required>
              <button type="submit" class="btn primary">Search</button>
            </div>
          </div>
        </form>
      </div>

      <div class="card hidden" id="results-card">
        <div class="card-header results-header">
          <div>
            <h2>Results & queue</h2>
            <p>Review search results, select items, and monitor downloads.</p>
          </div>
        </div>
        <div id="search-loading" class="loading-banner hidden" role="status" aria-live="polite">
          <div class="spinner" aria-hidden="true"></div>
          <div>
            <div class="loading-title">Searching…</div>
            <div class="muted" id="search-loading-text">Fetching results…</div>
          </div>
        </div>
        <div id="results-panel">
          <div class="results-actions" hidden>
            <div class="selection-group" hidden>
              <button type="button" id="select-all" class="btn ghost">Select all</button>
              <button type="button" id="select-none" class="btn ghost">Select none</button>
              <button type="button" id="select-invert" class="btn ghost">Invert selection</button>
            </div>
            <div class="action-group" hidden>
              <button id="view-queue" class="btn ghost" type="button" hidden>View download queue</button>
              <button id="download-btn" class="btn success" hidden>Download selected</button>
            </div>
          </div>
          <div id="results-empty" class="muted empty-state">Run a search to see results.</div>
          <div class="table-wrapper">
            <table id="results-table">
              <thead>
                <tr>
                  <th></th>
                  <th class="col-artist">Artist</th>
                  <th>Title</th>
                  <th class="col-year">Year</th>
                  <th>Type</th>
                  <th>Tracks</th>
                  <th>Explicit</th>
                  <th>Source</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
          <div id="queue-panel" class="hidden">
            <div class="panel-header">
              <h3>Download queue</h3>
              <button id="back-to-results" class="btn ghost">Back to results</button>
            </div>
          <div id="queue-list" class="stack" data-queue-list></div>
        </div>
      </div>
    </section>

    <section id="tab-url" class="tab-pane">
      <div class="card">
        <div class="card-header">
          <div>
            <h2>Download by URL</h2>
            <p>Paste one or multiple URLs (one per line) to enqueue downloads directly.</p>
          </div>
          <button id="url-download-btn" class="btn primary" disabled>Download URLs</button>
        </div>
        <label class="query-label" for="url-input">URLs</label>
        <textarea id="url-input" rows="6" placeholder="https://...&#10;https://..." aria-label="URL list"></textarea>
        <p class="muted">Supported streamrip URLs. The queue will show progress and any errors.</p>
      </div>
      <div class="card hidden" id="url-queue-card" data-queue-panel="url">
        <div class="card-header">
          <div>
            <h2>URL download queue</h2>
            <p>Progress for URLs you submitted. Errors stay visible for retry or saving.</p>
          </div>
        </div>
        <div id="url-queue-list" class="stack" data-queue-list></div>
      </div>
    </section>

    <section id="tab-saved" class="tab-pane">
      <div class="card">
        <div class="card-header">
          <div>
            <h2>Saved for later</h2>
            <p>Persisted items that failed or were deferred. Launch downloads anytime.</p>
          </div>
          <button id="download-saved" class="btn primary">Download all saved</button>
        </div>
        <div id="saved-list" class="stack"></div>
      </div>
    </section>

    <section id="tab-settings" class="tab-pane">
      <div class="card">
        <div class="card-header">
          <div>
            <h2>App preferences</h2>
            <p>Local-only settings that control this web UI.</p>
          </div>
          <button id="save-app-settings" class="btn primary">Save app settings</button>
        </div>
        <div id="app-settings-form" class="settings-grid"></div>
      </div>

      <div class="card">
        <div class="card-header">
          <div>
            <h2>Settings</h2>
            <p>Edit any streamrip configuration value. Sections mirror the config file.</p>
          </div>
          <button id="save-settings" class="btn primary">Save settings</button>
        </div>
        <div id="settings-form" class="settings-grid"></div>
      </div>
    </section>
  </main>

  <div id="toast-container" aria-live="polite"></div>

  <script>
    window.initialConfig = {{ config | tojson }};
    window.initialSaved = {{ saved | tojson }};
    window.initialHistory = {{ history | tojson }};
    window.initialAppSettings = {{ app_settings | tojson }};
    window.versionInfo = {{ versions | tojson }};
    window.appVersion = {{ app_version | tojson }};
  </script>
  <script src="/static/main.js?v={{ app_version }}"></script>
  <footer class="footer" aria-label="Version information">
    <div>
      <strong>App</strong>
      <div class="muted">
        v<a href="https://github.com/{{ versions.app.repo }}" target="_blank" rel="noreferrer noopener">{{ versions.app.version }}</a>
        · Latest
        <a href="https://github.com/{{ versions.app.repo }}" target="_blank" rel="noreferrer noopener">
          {{ versions.app.latest or 'unknown' }}
        </a>
      </div>
    </div>
    <div>
      <strong>streamrip</strong>
      <div class="muted">
        v<a href="https://github.com/{{ versions.streamrip.repo }}" target="_blank" rel="noreferrer noopener">{{ versions.streamrip.version }}</a>
        · Latest
        <a href="https://github.com/{{ versions.streamrip.repo }}" target="_blank" rel="noreferrer noopener">
          {{ versions.streamrip.latest or 'unknown' }}
        </a>
        · {{ versions.streamrip.source }}
      </div>
    </div>
  </footer>
</body>
</html>
