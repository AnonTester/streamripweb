<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>StreamRIP Web</title>
  <link rel="stylesheet" href="/static/style.css?v={{ app_version }}">
  <link rel="icon" type="image/png" href="/static/favicon.png">
  <link rel="apple-touch-icon" type="image/png" href="/static/favicon.png">
</head>
<body>
  <header class="header">
    <div class="logo" style="cursor: pointer;">
        <h1><img src="/static/logo.png" width="32" height="32"> StreamRIP Web</h1>
      <p class="subtitle">Full-featured web UI for the streamrip module</p>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-tab="search">Search</button>
    <button class="tab" data-tab="url">URL</button>
    <button class="tab" data-tab="saved">
      <span class="tab-label-full">Saved for later</span>
      <span class="tab-label-short">Later</span>
    </button>
    <button class="tab" data-tab="settings">Settings</button>
  </nav>

  <main>
    <section id="tab-search" class="tab-pane active">
      <div class="card" id="search-card">
        <div class="card-header">
          <div>
            <h2>Search</h2>
          </div>
          <div class="sse-status error" id="sse-status">Offline</div>
        </div>
        <form id="search-form" class="search-form">
          <div class="search-grid">
            <label>
              Source
              <select name="source" required>
                <option value="qobuz">Qobuz</option>
                <option value="tidal">Tidal</option>
                <option value="deezer">Deezer</option>
                <option value="soundcloud">SoundCloud</option>
              </select>
            </label>
            <label>
              Media type
              <select name="media_type" required>
                <option value="album">Album</option>
                <option value="track">Track</option>
                <option value="artist">Artist</option>
                <option value="playlist">Playlist</option>
                <option value="label">Label</option>
              </select>
            </label>
            <label>
              Max results
              <input type="number" name="limit" value="25" min="1" max="200">
            </label>
          </div>
          <div class="query-row">
            <label class="query-label" for="search-query">Query</label>
            <div class="query-input">
              <input id="search-query" type="search" name="query" placeholder="Artist, album, playlist…" required>
              <button type="submit" class="btn primary">Search</button>
            </div>
          </div>
        </form>
      </div>

      <div class="card hidden" id="results-card">
        <div class="card-header results-header">
          <div>
            <h2>Results & queue</h2>
            <p>Review search results, select items, and monitor downloads.</p>
          </div>
        </div>
        <div id="search-loading" class="loading-banner hidden" role="status" aria-live="polite">
          <div class="spinner" aria-hidden="true"></div>
          <div>
            <div class="loading-title">Searching…</div>
            <div class="muted" id="search-loading-text">Fetching results…</div>
          </div>
        </div>
        <div id="results-panel">
          <div class="results-actions" hidden>
            <div class="selection-group" hidden>
              <button type="button" id="select-all" class="btn ghost">Select all</button>
              <button type="button" id="select-none" class="btn ghost">Select none</button>
              <button type="button" id="select-invert" class="btn ghost">Invert selection</button>
            </div>
            <div class="action-group" hidden>
              <button id="view-queue" class="btn ghost" type="button" hidden>View download queue</button>
              <button id="download-btn" class="btn success" hidden>Download selected</button>
            </div>
          </div>
          <div id="results-empty" class="muted empty-state">Run a search to see results.</div>
          <div class="table-wrapper">
            <table id="results-table">
              <thead>
                <tr>
                  <th></th>
                  <th class="col-artist">Artist</th>
                  <th class="col-title">Title</th>
                  <th class="col-year">Year</th>
                  <th class="col-type">Type</th>
                  <th class="col-tracks">Tracks</th>
                  <th class="col-explicit">Explicit</th>
                  <th class="col-source">Source</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
          <div id="queue-panel" class="hidden">
            <div class="panel-header">
              <h3>Download queue</h3>
              <button id="back-to-results" class="btn ghost">Back to results</button>
            </div>
          <div id="queue-list" class="stack" data-queue-list></div>
        </div>
      </div>
    </section>

    <section id="tab-url" class="tab-pane">
      <div class="card">
        <div class="card-header">
          <div>
            <h2>Download by URL</h2>
            <p>Paste one or multiple URLs (one per line) to enqueue downloads directly.</p>
          </div>
        </div>
        <label class="query-label" for="url-input">URLs</label>
        <textarea id="url-input" rows="6" placeholder="https://...&#10;https://..." aria-label="URL list"></textarea>
        <p class="muted">Supported streamrip URLs. The queue will show progress and any errors.</p>
        <div class="form-actions url-actions">
          <button id="url-download-btn" class="btn primary" disabled>Download URLs</button>
        </div>
      </div>
      <div class="card hidden" id="url-queue-card" data-queue-panel="url">
        <div class="card-header">
          <div>
            <h2>URL download queue</h2>
            <p>Progress for URLs you submitted. Errors stay visible for retry or saving.</p>
          </div>
        </div>
        <div id="url-queue-list" class="stack" data-queue-list></div>
      </div>
    </section>

    <section id="tab-saved" class="tab-pane">
      <div class="card">
        <div class="card-header">
          <div>
            <h2>Saved for later</h2>
            <p>Persisted items that failed or were deferred. Launch downloads anytime.</p>
          </div>
        </div>
        <div id="saved-list" class="stack"></div>
        <div class="form-actions saved-actions">
          <button id="download-saved" class="btn primary">Download all saved</button>
        </div>
      </div>
    </section>

    <section id="tab-settings" class="tab-pane">
      <div class="card">
        <div class="card-header">
          <div>
            <h2>Settings</h2>
          </div>
          <div class="settings-header-actions">
            <button id="discard-settings" class="btn ghost hidden">Discard changes</button>
            <button id="save-settings" class="btn primary hidden" disabled>Save changes</button>
          </div>
        </div>
        <div id="download-folder-warning" class="alert alert-warning hidden">
          A download folder is required before leaving settings. Please set one in the Download group.
        </div>
        <div class="settings-modal-body">
          <div class="settings-tabs" role="tablist" aria-orientation="vertical" id="settings-tablist">
            <button class="settings-tab active" id="settings-tab-web" role="tab" aria-selected="true" data-settings-tab="web">StreamRIP Web</button>
            <button class="settings-tab" id="settings-tab-download" role="tab" aria-selected="false" data-settings-tab="download">Download</button>
            <button class="settings-tab" id="settings-tab-sources" role="tab" aria-selected="false" data-settings-tab="sources">Sources</button>
          </div>
          <div class="settings-panels" id="settings-panels">
            <div class="settings-group" data-settings-panel="web" role="tabpanel" aria-labelledby="settings-tab-web"></div>
            <div class="settings-group hidden" data-settings-panel="download" role="tabpanel" aria-labelledby="settings-tab-download"></div>
            <div class="settings-group hidden" data-settings-panel="sources" role="tabpanel" aria-labelledby="settings-tab-sources"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="toast-container" aria-live="polite"></div>

  <div id="unsaved-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="unsaved-modal-title">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <h3 id="unsaved-modal-title">Unsaved changes</h3>
          <p class="muted" id="unsaved-modal-message">You have unsaved changes. Save or discard them?</p>
        </div>
      </div>
      <div class="modal-actions modal-actions-inline">
        <button id="unsaved-cancel" class="btn ghost">Cancel</button>
        <button id="unsaved-discard" class="btn">Discard</button>
        <button id="unsaved-save" class="btn primary">Save &amp; continue</button>
      </div>
    </div>
  </div>

  <script>
    window.initialConfig = {{ config | tojson }};
    window.initialSaved = {{ saved | tojson }};
    window.initialHistory = {{ history | tojson }};
    window.initialAppSettings = {{ app_settings | tojson }};
    window.versionInfo = {{ versions | tojson }};
    window.appVersion = {{ app_version | tojson }};
    window.requireDownloadFolder = {{ require_download_folder | tojson }};
  </script>
  <script src="/static/main.js?v={{ app_version }}"></script>
  <footer class="footer" aria-label="Version information">
    <div>
      <div class="muted">
        <strong>StreamRIP Web</strong>
        v<a href="https://github.com/{{ versions.app.repo }}" target="_blank" rel="noreferrer noopener">{{ versions.app.version }}</a>
        {% if versions.app.update_available and versions.app.latest %}
        · Update available:
        <a href="https://github.com/{{ versions.app.repo }}/commit/{{ versions.app.latest }}" target="_blank" rel="noreferrer noopener">
          {{ versions.app.latest_label }}
        </a>
        {% endif %}
      </div>
    </div>
    <div>
      <div class="muted">
        <strong>streamrip</strong>
        v<a href="https://github.com/{{ versions.streamrip.repo }}" target="_blank" rel="noreferrer noopener">{{ versions.streamrip.version }}</a>
        {% if versions.streamrip.git_commit %}
          ({{ versions.streamrip.git_commit }})
        {% endif %}
        · {{ versions.streamrip.source }}
        {% if versions.streamrip.update_available and versions.streamrip.latest %}
        · Update available:
        <a href="{{ versions.streamrip.latest_url or ('https://github.com/' ~ versions.streamrip.repo ~ '/commit/' ~ versions.streamrip.latest) }}" target="_blank" rel="noreferrer noopener">
          {{ versions.streamrip.latest_label }}
        </a>
        {% endif %}
      </div>
    </div>
  </footer>
</body>
</html>
